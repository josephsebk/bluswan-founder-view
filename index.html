<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#050505">
    <title>Founder Personalized Schedule</title>

    <!-- Dependencies -->
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&amp;display=swap"
        rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
    <script src="assets/investor_images.js"></script>

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#2ECC71",
                        "alert": "#F39C12",
                        "background-dark": "#050505",
                        "surface-dark": "#121212",
                        "surface-lighter": "#1A1A1A",
                    },
                    fontFamily: {
                        "display": ["Inter", "-apple-system", "BlinkMacSystemFont", "Segoe UI", "Roboto", "Helvetica", "Arial", "sans-serif"],
                    },
                    boxShadow: {
                        'glow': '0 0 20px rgba(46, 204, 113, 0.25)',
                        'glow-alert': '0 0 20px rgba(243, 156, 18, 0.25)',
                    }
                },
            },
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #050505;
            -webkit-font-smoothing: antialiased;
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .mask-linear-fade {
            -webkit-mask-image: linear-gradient(to right, black 85%, transparent 100%);
            mask-image: linear-gradient(to right, black 85%, transparent 100%);
        }

        .safe-area-pb {
            padding-bottom: env(safe-area-inset-bottom, 20px);
        }

        .material-symbols-outlined.fill-1 {
            font-variation-settings: 'FILL' 1, 'wght' 400, 'GRAD' 0, 'opsz' 24
        }
    </style>
</head>

<body
    class="bg-background-dark text-white h-[100dvh] w-full flex flex-col overflow-hidden font-display selection:bg-primary selection:text-black">
    <div id="root" class="h-full w-full flex flex-col"></div>

    <script type="text/babel" data-type="module">
        const { useState, useEffect, useMemo, useCallback } = React;

        // Configuration
        const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyB5b-raK5TB8jae94FinurfCCdMVMIiJquzkTTYnejocMLPj_GpnLl4Idor8-ccQ0Wsg/exec";
        const POLL_INTERVAL = 10000;

        // Fallback if script fails
        if (typeof INVESTOR_IMAGES === 'undefined') { var INVESTOR_IMAGES = {}; }

        // Rooms
        const ROOMS = [
            { name: "GF-LAZE", floor: "Ground Floor" }, { name: "GF-Clout", floor: "Ground Floor" },
            { name: "GF-Navigate", floor: "Ground Floor" }, { name: "GF-Library", floor: "Ground Floor" },
            { name: "FF-Buzz", floor: "First Floor" }, { name: "FF-Ponder", floor: "First Floor" },
            { name: "FF-Balance", floor: "First Floor" }, { name: "FF-Aspire", floor: "First Floor" },
            { name: "FF-Curate", floor: "First Floor" }, { name: "FF-Introspect", floor: "First Floor" },
            { name: "FF-Library", floor: "First Floor" },
        ];

        function getRoomFloor(roomName) {
            if (!roomName) return "Unknown";
            const r = ROOMS.find(r => r.name.toLowerCase() === roomName.toLowerCase());
            if (!r) {
                if (roomName.startsWith("GF")) return "Ground Floor";
                if (roomName.startsWith("FF")) return "First Floor";
                return "Unknown";
            }
            return r.floor;
        }

        function App() {
            const [view, setView] = useState("login");
            const [founder, setFounder] = useState(null);
            const [meetings, setMeetings] = useState([]);
            const [loading, setLoading] = useState(false);
            const [lastSync, setLastSync] = useState(null);

            const fetchMeetings = useCallback(async () => {
                try {
                    const res = await fetch(`${APPS_SCRIPT_URL}?action=getMeetings`);
                    const data = await res.json();
                    if (data.meetings) {
                        // FIX: Replace "11:30 PM", "10:00 PM", "10:45 PM" with AM
                        const fixedMeetings = data.meetings.map(m => ({
                            ...m,
                            timeSlot: m.timeSlot ? m.timeSlot
                                .replace("11:30 PM", "11:30 AM")
                                .replace("10:00 PM", "10:00 AM")
                                .replace("10:45 PM", "10:45 AM") : m.timeSlot
                        }));
                        setMeetings(fixedMeetings);
                        setLastSync(new Date());
                    }
                } catch (e) { console.error("Fetch error", e); }
            }, []);

            useEffect(() => {
                setLoading(true);
                fetchMeetings().finally(() => setLoading(false));
                const interval = setInterval(fetchMeetings, POLL_INTERVAL);
                return () => clearInterval(interval);
            }, [fetchMeetings]);

            const founders = useMemo(() => {
                const names = new Set();
                meetings.forEach(m => {
                    if (m.company) names.add(m.company);
                    if (m.founder && m.founder !== m.company) names.add(m.founder);
                });
                return Array.from(names).filter(Boolean).sort();
            }, [meetings]);

            const myMeetings = useMemo(() => {
                if (!founder) return [];
                return meetings.filter(m => (m.company === founder || m.founder === founder)).sort((a, b) => a.id - b.id);
            }, [meetings, founder]);

            const timeSlots = useMemo(() => {
                const slots = Array.from(new Set(myMeetings.map(m => m.timeSlot))).filter(Boolean);
                // Sort by time
                return slots.sort((a, b) => {
                    // heuristic: "11:30 PM" (morning/night?) vs "1:00 PM"
                    // The data has a quirk where 11:30 AM might be labeled PM, or it's late night.
                    // Given the schedule is likely sequential, reliable string sort or simple AM/PM logic might suffice.
                    // Let's try to just preserve the order they appear in the full list if possible, or string sort.
                    // Actually, string sort "11..." vs "01..." works if format is consistent.
                    // Let's just sort by string for now to group them.
                    return a.localeCompare(b);
                });
            }, [myMeetings]);

            const scrollToTime = (slot) => {
                const el = document.getElementById(`slot-${slot}`);
                if (el) {
                    el.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            };

            if (view === "login") {
                return (
                    <div className="flex flex-col h-full w-full overflow-y-auto">
                        <div className="m-auto w-full max-w-sm flex flex-col items-center p-6 py-12">
                            <div className="text-center mb-12">
                                <div className="text-6xl mb-4">ü¶¢</div>
                                <h1 className="text-3xl font-bold tracking-tight">Welcome, Founder</h1>
                                <p className="text-white/40 mt-2">Select your company to view schedule</p>
                            </div>
                            {loading && founders.length === 0 ? (
                                <div className="flex items-center gap-2 text-primary/80">
                                    <span className="animate-spin material-symbols-outlined">sync</span>
                                    Loading...
                                </div>
                            ) : founders.length === 0 ? (
                                <div className="text-center flex flex-col items-center">
                                    <div className="text-4xl mb-4">‚ö†Ô∏è</div>
                                    <h3 className="text-lg font-bold">Unable to load data</h3>
                                    <p className="text-white/40 text-sm mb-6 max-w-[200px]">Check your internet connection or try again.</p>
                                    <button onClick={() => { setLoading(true); fetchMeetings().finally(() => setLoading(false)); }}
                                        className="flex items-center gap-2 px-6 py-3 bg-white/10 hover:bg-white/20 rounded-xl transition-all font-medium">
                                        <span className="material-symbols-outlined">refresh</span>
                                        Retry
                                    </button>
                                </div>
                            ) : (
                                <div className="w-full max-w-sm space-y-3">
                                    {founders.map(f => (
                                        <button key={f} onClick={() => { setFounder(f); setView("schedule"); }}
                                            className="w-full flex items-center gap-4 bg-surface-lighter hover:bg-white/10 border border-white/5 p-4 rounded-2xl transition-all active:scale-[0.98]">
                                            <div className="h-10 w-10 rounded-full bg-white/10 flex items-center justify-center text-lg font-bold">
                                                {f[0]}
                                            </div>
                                            <span className="text-lg font-semibold">{f}</span>
                                            <span className="material-symbols-outlined ml-auto text-white/20">arrow_forward</span>
                                        </button>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            return (
                <div className="flex flex-col h-full overflow-hidden">
                    {/* Header */}
                    <header className="flex-none pt-12 pb-4 px-5 bg-background-dark z-20 sticky top-0 border-b border-white/5">
                        <div className="flex items-center justify-between mb-6">
                            <button onClick={() => setView('login')} className="flex items-center gap-2 text-white/60 hover:text-white transition-colors cursor-pointer">
                                <span className="material-symbols-outlined text-[20px]">arrow_back</span>
                                <span className="text-sm font-medium">Back</span>
                            </button>
                            <div className="bg-primary/20 border border-primary/30 px-3 py-1 rounded-full flex items-center gap-1.5">
                                <span className="relative flex h-2 w-2">
                                    <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-primary opacity-75"></span>
                                    <span className="relative inline-flex rounded-full h-2 w-2 bg-primary"></span>
                                </span>
                                <span className="text-[10px] font-bold tracking-wider text-primary uppercase">{lastSync ? "LIVE" : "SYNCING"}</span>
                            </div>
                        </div>
                        <h1 className="text-3xl font-bold tracking-tight text-white">{founder}</h1>
                        <p className="text-white/40 text-sm font-medium mt-1">BluSwan 2026 ‚Ä¢ Founder Schedule</p>


                    </header>

                    {/* Main Content */}
                    <main className="flex-1 overflow-y-auto min-h-0 px-5 py-2 pb-24 space-y-6">
                        {myMeetings.length === 0 && (
                            <div className="text-center py-20 text-white/30">
                                <span className="material-symbols-outlined text-4xl mb-2">calendar_today</span>
                                <p>No meetings found.</p>
                            </div>
                        )}

                        {myMeetings.map((m, i) => {
                            const currentFloor = getRoomFloor(m.room);
                            let showMove = false;
                            let prevFloor = null;

                            if (i > 0) {
                                const prevM = myMeetings[i - 1];
                                prevFloor = getRoomFloor(prevM.room);
                                if (currentFloor !== prevFloor && prevFloor !== "Unknown" && currentFloor !== "Unknown") {
                                    showMove = true;
                                }
                            }

                            const isStarted = m.status === 'started';
                            const isFirst = i === 0;
                            const sectionTitle = isStarted ? "Current Session" : (isFirst ? "Up Next" : "Upcoming");
                            const cardClass = isStarted
                                ? "block relative w-full rounded-[20px] bg-gradient-to-br from-[#151515] to-black border-2 border-primary shadow-glow overflow-hidden group"
                                : (isFirst
                                    ? "block relative w-full rounded-[20px] bg-surface-lighter border border-white/5 p-6 active:scale-[0.99] transition-transform"
                                    : "block relative w-full rounded-[20px] bg-surface-dark border border-white/5 p-6 opacity-80");

                            const repImage = INVESTOR_IMAGES[m.rep];

                            return (
                                <React.Fragment key={m.id}>
                                    {/* Floor Change Banner */}
                                    {showMove && (
                                        <div className="relative overflow-hidden rounded-xl bg-gradient-to-r from-[#F39C12]/20 to-[#F39C12]/5 border border-[#F39C12]/40 p-4 shadow-glow-alert flex items-center justify-between mb-4">
                                            <div className="absolute top-0 left-0 w-1 h-full bg-[#F39C12]"></div>
                                            <div className="flex items-center gap-4 z-10">
                                                <div className="h-10 w-10 rounded-full bg-[#F39C12]/20 flex items-center justify-center text-[#F39C12]">
                                                    <span className="material-symbols-outlined">elevator</span>
                                                </div>
                                                <div>
                                                    <h4 className="text-[#F39C12] font-bold text-sm tracking-wide uppercase">Change Floors</h4>
                                                    <p className="text-[#F39C12]/80 text-xs">Go from <span className="text-white font-semibold">{prevFloor}</span> to <span class="text-white font-semibold">{currentFloor}</span></p>
                                                </div>
                                            </div>
                                            <span className="material-symbols-outlined text-[#F39C12]/60 -rotate-45">arrow_forward</span>
                                        </div>
                                    )}

                                    <section id={`slot-${m.timeSlot}`}>
                                        <div className="flex justify-between items-baseline mb-3 px-1">
                                            <h2 className={`text-xs font-bold uppercase tracking-widest ${isStarted ? 'text-primary' : 'text-white/60'}`}>{sectionTitle}</h2>
                                            <span className="text-xs text-white/40 font-mono">{m.timeSlot}</span>
                                        </div>
                                        <div className={cardClass}>
                                            {isStarted && <div className="absolute inset-0 opacity-20 bg-[radial-gradient(ellipse_at_top_right,_var(--tw-gradient-stops))] from-primary/30 via-transparent to-transparent"></div>}

                                            <div className={`relative ${isStarted ? 'p-6 z-10' : ''}`}>
                                                <div className="flex justify-between items-start mb-6">
                                                    <div className="flex flex-col">
                                                        <span className={`text-xs font-semibold mb-1 uppercase tracking-wider flex items-center gap-1.5 ${isStarted ? 'text-primary/80' : 'text-white/40'}`}>
                                                            <span className="material-symbols-outlined text-[16px]">meeting_room</span>
                                                            {currentFloor === "Unknown" ? m.room : `${m.room} ‚Ä¢ ${currentFloor}`}
                                                        </span>
                                                        <h3 className={`font-bold text-white leading-tight ${isStarted ? 'text-2xl' : 'text-xl'}`}>{m.investor}</h3>
                                                    </div>
                                                    {/* Conditional Floor Badge */}
                                                    <div className={`h-10 w-10 rounded-full flex items-center justify-center border ${isStarted ? 'bg-white/5 border-white/10' : 'bg-white/5 border-white/5 text-white/30'}`}>
                                                        {isStarted ? <span className="text-lg font-bold text-white">{m.investor[0]}</span> : <span className="material-symbols-outlined">apartment</span>}
                                                    </div>
                                                </div>

                                                {isStarted && <div className="h-px w-full bg-gradient-to-r from-transparent via-white/10 to-transparent my-4"></div>}

                                                {isStarted ? (
                                                    <div className="flex items-center gap-4">
                                                        <div className="h-12 w-12 rounded-xl bg-white/5 flex items-center justify-center overflow-hidden border border-white/10">
                                                            {repImage ? <img src={repImage} className="h-full w-full object-cover opacity-80" /> : <span className="text-2xl">üíº</span>}
                                                        </div>
                                                        <div>
                                                            <p className="text-[10px] text-white/40 uppercase font-bold tracking-wider mb-0.5">Rep</p>
                                                            <p className="text-white font-medium">{m.rep}</p>
                                                        </div>
                                                    </div>
                                                ) : (
                                                    <div className="flex items-center gap-3 pt-4 border-t border-white/5">
                                                        <div className="h-8 w-8 rounded-full bg-indigo-500/20 flex items-center justify-center text-indigo-400 text-xs font-bold">
                                                            {currentFloor.startsWith('Ground') ? 'GF' : 'FF'}
                                                        </div>
                                                        <div>
                                                            <p className="text-sm text-white/80 font-medium">{currentFloor}</p>
                                                            <p className="text-xs text-white/30">{currentFloor}</p>
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    </section>
                                </React.Fragment>
                            );
                        })}
                    </main>

                    {/* Bottom Nav */}
                    <nav className="flex-none bg-background-dark/90 backdrop-blur-xl border-t border-white/10 px-6 py-4 flex justify-around items-center z-50 safe-area-pb">
                        <button className="flex flex-col items-center gap-1 text-primary">
                            <span className="material-symbols-outlined fill-1">calendar_today</span>
                            <span className="text-[10px] font-medium">Schedule</span>
                        </button>
                        <button className="flex flex-col items-center gap-1 text-white/40 hover:text-white transition-colors">
                            <span className="material-symbols-outlined">map</span>
                            <span className="text-[10px] font-medium">Map</span>
                        </button>
                        <button className="flex flex-col items-center gap-1 text-white/40 hover:text-white transition-colors">
                            <span className="material-symbols-outlined">notifications</span>
                            <span className="text-[10px] font-medium">Alerts</span>
                        </button>
                    </nav>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById("root"));
        root.render(<App />);
    </script>
</body>

</html>